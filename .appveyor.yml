image: Ubuntu2204 # образ для сборки

environment:
  matrix:
    - nodejs_version: "20"

branches:
  only:
    - master # ветка git
    - main

cache: node_modules # кеширование

install:
  - npm install # установка зависимостей

build: off # отключаем встроенную в AppVeyor систему сборки

build_script:
  - npm run build # сборка фронтенда

test_script:
  # Комментируем или добавляем e2e-тесты при необходимости
  # - npm run e2e

# Настраиваем запуск серверной и клиентской части
deploy_script:
  - git config --global credential.helper store
  - git config --global user.name AppVeyor
  - git config --global user.email ci@appveyor.com
  - echo "https://$GITHUB_TOKEN:x-oauth-basic@github.com" > "$HOME/.git-credentials"

  # Запуск server.js
  - nohup node server.js & # Запуск сервера в фоне

  # Публикация клиентской части из dist на GitHub Pages
  - npx gh-pages -d dist -u "appveyor-bot <ci@appveyor>"
